Plugin version @PLUGIN_VERSION@

Revised on February 07, 2022














== Plugin configurations

Plugin configurations are sets of parameters that apply
across some or all of the plugin procedures. They
reduce repetition of common values, create
predefined parameter sets for end users, and
securely store credentials where needed. Each configuration
is given a unique name that is entered in designated
parameters on procedures that use them.


=== Creating plugin configurations

To create plugin configurations in {CD}, do these steps:

* Go to menu:Administration[Plugins] to open the Plugin Manager.
* Find the @PLUGIN_NAME@ row.
* Click *Configure* to open the
     Configurations page.
* Click *Create Configuration* as per the description of parameters below.



=== Configuration procedure parameters

[cols=",",options="header"]
|===
|Parameter |Description

|__**Configuration name**__ | The name for the created configuration


|Description | Description for the configuration


|__**gcloud path**__ | An absolute or relative path to gcloud executable.


|__**gcloud configuration name**__ | The name of the Google Cloud Platform configuration.


|Authorization type | Authorization type: either provide a JSON key file or use the instance metadata (a service account should be assigned to the instance) to authenticate API calls.



|Credential | Service account key in JSON format. For example,




{
  "type": "service_account",
  "project_id": "PROJECT ID",
  "private_key_id": "PRIVATE KEY ID",
  "private_key": "-----BEGIN PRIVATE KEY-----PRIVATE KEY CONTENT-----END PRIVATE KEY-----\n",
  "client_email": "SERVICE ACCOUNT NAME@PROJECT ID.iam.gserviceaccount.com",
  "client_id": "CLIENT ID",
  "auth_uri": "https://accounts.google.com/o/oauth2/auth",
  "token_uri": "https://oauth2.googleapis.com/token",
  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
  "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/ACCOUNT ID"
}



|Project name | The name of the Google Cloud Platform project.


|gcloud properties | Properties to pass to the configuration in format: SECTION/PROPERTY VALUE.
E.g.: compute/zone asia-east1-b



|Check configuration resource | A resource that is used for the checking configuration. gcloud CLI must be installed on the resource.


|Check Connection? | If checked, the connection endpoint and credentials entered as part of the configuration will be tested. If this option is checked, configuration will not be saved if the test fails.


|Debug Level | This option sets debug level for logs. If info is selected, only summary information will be shown, for debug, there will be some debug information and for trace the whole requests and responses will be shown.


|===





[[procedures]]
== Plugin procedures


IMPORTANT: For all parameter descriptions in this section, required parameters are shown in __**bold italics**__.




[[RunCustomCommand]]
=== Run Custom Command


This procedure allows run any gcloud command.



==== Run Custom Command parameters
[cols=",",options="header"]
|===
|Parameter |Description

| __**Configuration Name**__ | Previously defined configuration for the plugin


| __**Group of commands**__ | Name of the group of the commands. E.g.: `info`, `compute`, `iam`, `secrets`, etc.


| Command | Name of the command. E.g.: `instances`, `zones` for `compute` group of commands.


| Sub-commands/values | Name of the subcommands/values for the command separated by new lines. E.g.: `list` for `compute` + `zones` or `compute` + `instances`; Name of the instance for `compute` + `instances`.


| Options | Options to pass to gcloud executable separated by new lines. E.g.: `--option-name[=optionValue]`.


| __**Result property sheet**__ | Results will be saved into this property/property sheet.


|===



==== Output parameters

[cols=",",options="header"]
|===
|Parameter |Description

|runCustomCommand |STDOUT after accomplishing the command.

|===












== Use cases


=== Complex example

==== info

According to https://cloud.google.com/sdk/gcloud/reference/info[the official documentation] run the command.


[,bash]
----

gcloud info --format="json(basic,tools)" --anonymize

----

where following are separate four parameters to procedure:

* Group of commands: `info`
* Command:
* Sub-commands:
* Options: `--format="json(basic,tools)", --anonymize`

image::cloudbees-common-sda::cd-plugins/ec-gcloud/uc/ComplexExample-01.png[role="screenshot"]

Result:

[,json]
----

{
  "basic": {
    "architecture": {
      "file_name": "x86_64",
      "id": "x86_64",
      "name": "x86_64"
    },
    "locale": [
      "en_US",
      "UTF-8"
    ],
    "operating_system": {
      "file_name": "linux",
      "id": "LINUX",
      "name": "Linux"
    },
    "python_location": "/usr/bin/python3",
    "python_version": "3.8.10 (default, Sep 28 2021, 16:10:42) \n[GCC 9.3.0]",
    "site_packages": false,
    "version": "366.0.0"
  },
  "tools": {
    "git_version": "git version 2.25.1",
    "ssh_version": "OpenSSH_8.2p1 Ubuntu-4ubuntu0.3, OpenSSL 1.1.1f  31 Mar 2020"
  }
}

----

==== compute instances describe

According to https://cloud.google.com/sdk/gcloud/reference/compute/instances/describe[the official documentation] run the command.


[,bash]
----

gcloud compute instances describe test-instance --format="yaml(name,status,disks)"

----

where following are separate four parameters to procedure:

* Group of commands: `compute`
* Command: `instances`
* Sub-commands: `describe`, `test-instance`
* Options: `--format="yaml(name,status,disks)"`

image::cloudbees-common-sda::cd-plugins/ec-gcloud/uc/ComplexExample-02.png[role="screenshot"]


Result:

[,yaml]
----

disks:
- autoDelete: true
  boot: true
  deviceName: persistent-disk-0
  diskSizeGb: '10'
  guestOsFeatures:
  - type: UEFI_COMPATIBLE
  - type: VIRTIO_SCSI_MULTIQUEUE
  index: 0
  interface: SCSI
  kind: compute#attachedDisk
  licenses:
  - https://www.googleapis.com/compute/v1/projects/debian-cloud/global/licenses/debian-10-buster
  mode: READ_WRITE
  source: https://www.googleapis.com/compute/v1/projects/my-test-project/zones/us-east1-b/disks/test-instance
  type: PERSISTENT
name: test-instance
status: RUNNING

----








[[rns]]
== Release notes


=== EC-GCloud 1.0.0

- Initial Version. The following procedures were added.
* Run Custom Command
* Run Anything



